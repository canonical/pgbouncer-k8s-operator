[32mINFO    [0m pytest_operator.plugin:plugin.py:784 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.1.7    unsupported  01:30:39Z

App                       Version  Status   Scale  Charm                     Channel        Rev  Address         Exposed  Message
pgbouncer-k8s             1.21.0   error        2  pgbouncer-k8s                              0  10.152.183.220  no       hook failed: "update-status"
postgresql-k8s            14.10    waiting      3  postgresql-k8s            14/edge        199  10.152.183.115  no       installing agent
postgresql-test-app                active       1  postgresql-test-app       edge            55  10.152.183.61   no       received database credentials of the first database
self-signed-certificates           active       1  self-signed-certificates  latest/stable   72  10.152.183.60   no       

Unit                         Workload     Agent  Address       Ports  Message
pgbouncer-k8s/0*             error        idle   10.1.229.200         hook failed: "update-status"
pgbouncer-k8s/1              active       idle   10.1.229.201         
postgresql-k8s/0*            maintenance  idle   10.1.229.207         Executing restart operation
postgresql-k8s/1             unknown      idle   10.1.229.208         
postgresql-k8s/2             waiting      idle   10.1.229.209         awaiting for cluster to start
postgresql-test-app/0*       active       idle   10.1.229.202         received database credentials of the first database
self-signed-certificates/0*  active       idle   10.1.229.206         

[32mINFO    [0m pytest_operator.plugin:plugin.py:790 Juju error logs:

unit-pgbouncer-k8s-0: 01:30:38 ERROR unit.pgbouncer-k8s/0.juju-log Failed to get PostgreSQL version: connection to server at "postgresql-k8s-primary.test.svc.cluster.local" (10.152.183.185), port 5432 failed: FATAL:  the database system is shutting down

unit-pgbouncer-k8s-0: 01:30:38 ERROR unit.pgbouncer-k8s/0.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 411, in get_postgresql_version
    with self._connect_to_database() as connection, connection.cursor() as cursor:
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 127, in _connect_to_database
    connection = psycopg2.connect(
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "postgresql-k8s-primary.test.svc.cluster.local" (10.152.183.185), port 5432 failed: FATAL:  the database system is shutting down


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/./src/charm.py", line 831, in <module>
    main(PgBouncerK8sCharm)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/ops/main.py", line 456, in main
    _emit_charm_event(charm, dispatcher.event_name)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/ops/main.py", line 144, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/ops/framework.py", line 351, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/ops/framework.py", line 853, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/venv/ops/framework.py", line 943, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/./src/charm.py", line 376, in _on_update_status
    self.update_client_connection_info()
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/./src/charm.py", line 812, in update_client_connection_info
    self.client_relation.update_connection_info(relation)
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/src/relations/pgbouncer_provider.py", line 208, in update_connection_info
    relation.id, self.charm.backend.postgres.get_postgresql_version()
  File "/var/lib/juju/agents/unit-pgbouncer-k8s-0/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 417, in get_postgresql_version
    raise PostgreSQLGetPostgreSQLVersionError()
charms.postgresql_k8s.v0.postgresql.PostgreSQLGetPostgreSQLVersionError
unit-pgbouncer-k8s-0: 01:30:39 ERROR juju.worker.uniter.operation hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:856 Forgetting main...