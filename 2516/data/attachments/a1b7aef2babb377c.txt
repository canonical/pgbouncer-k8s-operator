[32mINFO    [0m integration.test_trust:test_trust.py:93 Deploying applications
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/postgresql-test-app-358
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/postgresql-k8s-495
[32mINFO    [0m juju.model:__init__.py:2301 Deploying local:jammy/pgbouncer-k8s-0
[32mINFO    [0m integration.test_trust:test_trust.py:124 Waiting until pgbouncer-k8s blocked due to lack of trust
[33mWARNING [0m juju.client.connection:connection.py:493 Receiver: Connection closed, reconnecting
[31m[1mERROR   [0m asyncio:base_events.py:1821 Task exception was never retrieved
future: <Task finished name='Task-358' coro=<Connection.reconnect() done, defined at /home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py:700> exception=OSError(9, 'Bad file descriptor')>
Traceback (most recent call last):
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 712, in reconnect
    res = await connector(
          ^^^^^^^^^^^^^^^^
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 803, in _connect_with_login
    await self._connect(endpoints)
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 746, in _connect
    result = await task
             ^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/tasks.py", line 631, in _wait_for_one
    return f.result()  # May raise f.exception().
           ^^^^^^^^^^
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 732, in _try_endpoint
    return await self._open(endpoint, cacert)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 333, in _open
    await websockets.connect(
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 444, in __await_impl__
    self.connection = await self.create_connection()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/pgbouncer-k8s-operator/pgbouncer-k8s-operator/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 370, in create_connection
    _, connection = await loop.create_connection(factory, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1149, in create_connection
    transport, protocol = await self._create_connection_transport(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1167, in _create_connection_transport
    sock.setblocking(False)
OSError: [Errno 9] Bad file descriptor
[32mINFO    [0m integration.test_trust:test_trust.py:138 Trusting application pgbouncer-k8s
[32mINFO    [0m integration.test_trust:test_trust.py:141 Relating application pgbouncer-k8s with postgresql-k8s
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [executing] unknown: 
  pgbouncer-k8s/0 [executing] blocked: waiting for backend database relation to initialise
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [executing] waiting: awaiting for primary endpoint to be ready
  pgbouncer-k8s/0 [idle] blocked: waiting for backend database relation to initialise
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [idle] waiting: awaiting for cluster to start
  pgbouncer-k8s/0 [idle] blocked: waiting for backend database relation to initialise
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [executing] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [idle] active: Primary
[32mINFO    [0m integration.test_trust:test_trust.py:147 Relating application pgbouncer-k8s with postgresql-test-app
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-test-app/0 [idle] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:929 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.6.2    unsupported  01:35:01Z

App                  Version  Status  Scale  Charm                Channel      Rev  Address         Exposed  Message
pgbouncer-k8s        1.21.0   active      1  pgbouncer-k8s                       0  10.152.183.80   no       
postgresql-k8s       14.15    active      1  postgresql-k8s       14/edge      495  10.152.183.226  no       
postgresql-test-app           active      1  postgresql-test-app  latest/edge  358  10.152.183.17   no       received database credentials of the first database

Unit                    Workload  Agent  Address       Ports  Message
pgbouncer-k8s/0*        active    idle   10.1.149.202         
postgresql-k8s/0*       active    idle   10.1.149.204         Primary
postgresql-test-app/0*  active    idle   10.1.149.201         received database credentials of the first database

[32mINFO    [0m pytest_operator.plugin:plugin.py:935 Juju error logs:

model-20e9c91d-ea15-4a4e-8a46-f390c8486c03: 01:30:53 ERROR juju.kubernetes.klog /build/snapcraft-juju-f42f47d9303ddadbbd81a5f3cdea4e95/parts/jujud/build/worker/caasrbacmapper/mapper.go:79: Failed to watch *v1.ServiceAccount: unknown (get serviceaccounts) - error from a previous attempt: read tcp 10.1.149.200:47122->10.152.183.1:443: read: connection reset by peer

[32mINFO    [0m pytest_operator.plugin:plugin.py:1017 Forgetting model main...