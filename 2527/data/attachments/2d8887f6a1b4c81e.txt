[32mINFO    [0m integration.test_trust:test_trust.py:90 Deploying applications
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/postgresql-test-app-360
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/postgresql-k8s-499
[32mINFO    [0m juju.model:__init__.py:2301 Deploying local:jammy/pgbouncer-k8s-0
[32mINFO    [0m integration.test_trust:test_trust.py:121 Waiting until pgbouncer-k8s blocked due to lack of trust
[33mWARNING [0m juju.client.connection:connection.py:493 Receiver: Connection closed, reconnecting
[1m[31mERROR   [0m asyncio:base_events.py:1821 Task exception was never retrieved
future: <Task finished name='Task-341' coro=<Connection.reconnect() done, defined at /root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py:700> exception=OSError(9, 'Bad file descriptor')>
Traceback (most recent call last):
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 712, in reconnect
    res = await connector(
          ^^^^^^^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 803, in _connect_with_login
    await self._connect(endpoints)
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 746, in _connect
    result = await task
             ^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/tasks.py", line 631, in _wait_for_one
    return f.result()  # May raise f.exception().
           ^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 732, in _try_endpoint
    return await self._open(endpoint, cacert)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 333, in _open
    await websockets.connect(
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 444, in __await_impl__
    self.connection = await self.create_connection()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 370, in create_connection
    _, connection = await loop.create_connection(factory, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1149, in create_connection
    transport, protocol = await self._create_connection_transport(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1167, in _create_connection_transport
    sock.setblocking(False)
OSError: [Errno 9] Bad file descriptor
[32mINFO    [0m integration.test_trust:test_trust.py:135 Trusting application pgbouncer-k8s
[32mINFO    [0m integration.test_trust:test_trust.py:138 Relating application pgbouncer-k8s with postgresql-k8s
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [executing] unknown: 
  pgbouncer-k8s/0 [executing] blocked: Insufficient permissions, try: `juju trust pgbouncer-k8s --scope=cluster`
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [idle] waiting: awaiting for cluster to start
  pgbouncer-k8s/0 [idle] blocked: waiting for backend database relation to initialise
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s/0 [executing] active: Primary
  pgbouncer-k8s/0 [idle] active: 
[32mINFO    [0m integration.test_trust:test_trust.py:144 Relating application pgbouncer-k8s with postgresql-test-app
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-test-app/0 [idle] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:929 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.2    unsupported  01:34:42Z

App                  Version  Status  Scale  Charm                Channel      Rev  Address         Exposed  Message
pgbouncer-k8s        1.21.0   active      1  pgbouncer-k8s                       0  10.152.183.48   no       
postgresql-k8s       14.15    active      1  postgresql-k8s       14/edge      499  10.152.183.174  no       
postgresql-test-app           active      1  postgresql-test-app  latest/edge  360  10.152.183.170  no       received database credentials of the first database

Unit                    Workload  Agent  Address       Ports  Message
pgbouncer-k8s/0*        active    idle   10.1.208.202         
postgresql-k8s/0*       active    idle   10.1.208.204         Primary
postgresql-test-app/0*  active    idle   10.1.208.201         received database credentials of the first database

[32mINFO    [0m pytest_operator.plugin:plugin.py:935 Juju error logs:


[32mINFO    [0m pytest_operator.plugin:plugin.py:1017 Forgetting model main...