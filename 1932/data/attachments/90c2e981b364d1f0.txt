[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s (waiting for exactly 3 units, current : 1)
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/0 [executing] active: 
  pgbouncer-k8s/2 [executing] blocked: waiting for backend database relation to initialise
  pgbouncer-k8s/1 [executing] blocked: waiting for backend database relation to initialise
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/0 [executing] active: 
  pgbouncer-k8s/2 [executing] active: 
  pgbouncer-k8s/1 [executing] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/0 [executing] active: 
  pgbouncer-k8s/2 [executing] active: 
  pgbouncer-k8s/1 [executing] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/2 [executing] active: 
  pgbouncer-k8s/1 [executing] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  postgresql-k8s/0 [idle] active: Primary
  postgresql-k8s/1 [idle] active: 
  postgresql-k8s/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/0 [idle] active: 
  pgbouncer-k8s/2 [idle] active: 
  pgbouncer-k8s/1 [idle] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s (waiting for exactly 1 units, current : 3)
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s (waiting for exactly 1 units, current : 3)
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  postgresql-k8s/0 [idle] active: Primary
  postgresql-k8s/1 [idle] active: 
  postgresql-k8s/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  pgbouncer-k8s/0 [idle] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.1.8    unsupported  01:47:43Z

App                       Version  Status  Scale  Charm                     Channel        Rev  Address         Exposed  Message
finos-waltz                        active      1  finos-waltz-k8s           edge            33  10.152.183.81   no       
pgbouncer-k8s             1.21.0   active      1  pgbouncer-k8s                              0  10.152.183.194  no       
postgresql-k8s            14.11    active      3  postgresql-k8s            14/edge        290  10.152.183.166  no       
self-signed-certificates           active      1  self-signed-certificates  latest/stable  151  10.152.183.102  no       

Unit                         Workload  Agent  Address     Ports  Message
finos-waltz/0*               active    idle   10.1.4.144         
pgbouncer-k8s/0*             active    idle   10.1.4.136         
postgresql-k8s/0*            active    idle   10.1.4.140         Primary
postgresql-k8s/1             active    idle   10.1.4.142         
postgresql-k8s/2             active    idle   10.1.4.141         
self-signed-certificates/0*  active    idle   10.1.4.143         

[32mINFO    [0m pytest_operator.plugin:plugin.py:868 Juju error logs:

unit-finos-waltz-0: 01:43:56 ERROR unit.finos-waltz/0.juju-log db:8: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "./src/charm.py", line 200, in <module>
    main.main(WaltzOperatorCharm)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/main.py", line 456, in main
    _emit_charm_event(charm, dispatcher.event_name)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/main.py", line 144, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 352, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 865, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 955, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/pgsql/opslib/pgsql/client.py", line 408, in _on_changed
    self.on.master_changed.emit(**kwargs)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 352, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 865, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/framework.py", line 955, in _reemit
    custom_handler(event)
  File "./src/charm.py", line 83, in _on_master_changed
    self._rebuild_waltz_pebble_layer(event)
  File "./src/charm.py", line 131, in _rebuild_waltz_pebble_layer
    container.restart("waltz")
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/model.py", line 2136, in restart
    self._pebble.restart_services(service_names)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/pebble.py", line 1962, in restart_services
    return self._services_action('restart', services, timeout, delay)
  File "/var/lib/juju/agents/unit-finos-waltz-0/charm/venv/ops/pebble.py", line 1983, in _services_action
    raise ChangeError(change.err, change)
ops.pebble.ChangeError: cannot perform the following tasks:
- Start service "waltz" (cannot start service: exited quickly with code 1)
----- Logs from task 0 -----
2024-06-27T01:43:55Z INFO Service "waltz" has never been started.
----- Logs from task 1 -----
2024-06-27T01:43:56Z INFO Most recent service output:
    (...)
    ##  | |    _  __ _ _   _ _| |__   __ _ ___  ___   ##
    ##  | |   | |/ _` | | | | | '_ \ / _` / __|/ _ \  ##
    ##  | |___| | (_| | |_| | | |_) | (_| \__ \  __/  ##
    ##  \_____/_|\__, |\__,_|_|_.__/ \__,_|___/\___|  ##
    ##              | |                               ##
    ##              |_|                               ##
    ##                                                ## 
    ##  Get documentation at docs.liquibase.com       ##
    ##  Get certified courses at learn.liquibase.com  ## 
    ##  Free schema change activity reports at        ##
    ##      https://hub.liquibase.com                 ##
    ##                                                ##
    ####################################################
    Starting Liquibase at 01:43:55 (version 4.5.0 #52 built at 2021-09-27 16:19+0000)
    Liquibase Version: 4.5.0
    Liquibase Community 4.5.0 by Datical
    Unexpected error running Liquibase: Connection could not be created to jdbc:postgresql://pgbouncer-k8s-0.pgbouncer-k8s-endpoints.test.svc.cluster.local:6432/waltz with driver org.postgresql.Driver.  The connection attempt failed.
    
    For more information, please use the --log-level flag
    >>> Database failed to update.
2024-06-27T01:43:56Z ERROR cannot start service: exited quickly with code 1
-----
unit-finos-waltz-0: 01:43:56 ERROR juju.worker.uniter.operation hook "db-relation-changed" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:947 Forgetting model main...